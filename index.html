<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>L5-L6 è‹±æ–‡å–®å­—å£èªªæŒ‘æˆ°ç«™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js" type="module"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;800&display=swap');
        * { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Lexend', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; overflow-x: hidden; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 28px; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07); }
        .key-btn { @apply bg-slate-100 rounded-2xl p-4 text-2xl font-bold text-slate-700 transition-all active:scale-90 active:bg-slate-200 flex items-center justify-center; }
        .unit-tab-active { @apply bg-indigo-600 text-white shadow-lg; }
        .recording-pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        .modal-overlay { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(6px); }
        .speed-btn { @apply flex items-center justify-center space-x-1 px-3 py-2 rounded-xl border border-slate-100 bg-white text-[11px] font-bold text-slate-500 shadow-sm transition-all active:scale-90; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .input-active { @apply border-indigo-500 ring-4 ring-indigo-100 bg-white !text-indigo-600; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- ç™»å…¥èˆ‡æ•¸å­—éµç›¤ Modal -->
    <div id="login-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white w-full max-w-sm rounded-[40px] p-8 shadow-2xl text-center animate-fade-in">
            <h2 class="text-3xl font-extrabold text-slate-800 mb-2">ğŸ—£ï¸ å–®å­—é—–é—œç«™</h2>
            <p id="login-status" class="text-slate-500 font-medium mb-6">é»æ“Šä¸‹æ–¹æ¬„ä½é€²è¡Œè¼¸å…¥</p>
            
            <div class="flex space-x-3 mb-6">
                <div class="flex-1" onclick="setActiveInput('class')">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">ç­ç´š</label>
                    <div id="class-display" class="w-full bg-slate-100 border-2 border-transparent rounded-2xl py-3 text-center text-2xl font-black text-slate-300 h-[52px] flex items-center justify-center transition-all italic">--</div>
                </div>
                <div class="flex-1" onclick="setActiveInput('seat')">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">åº§è™Ÿ</label>
                    <div id="seat-display" class="w-full bg-slate-100 border-2 border-transparent rounded-2xl py-3 text-center text-2xl font-black text-slate-300 h-[52px] flex items-center justify-center transition-all italic">--</div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 mb-6">
                <button onclick="pressKey('1')" class="key-btn">1</button>
                <button onclick="pressKey('2')" class="key-btn">2</button>
                <button onclick="pressKey('3')" class="key-btn">3</button>
                <button onclick="pressKey('4')" class="key-btn">4</button>
                <button onclick="pressKey('5')" class="key-btn">5</button>
                <button onclick="pressKey('6')" class="key-btn">6</button>
                <button onclick="pressKey('7')" class="key-btn">7</button>
                <button onclick="pressKey('8')" class="key-btn">8</button>
                <button onclick="pressKey('9')" class="key-btn">9</button>
                <button onclick="pressKey('clear')" class="key-btn text-red-500 text-xs font-bold uppercase">æ¸…é™¤</button>
                <button onclick="pressKey('0')" class="key-btn">0</button>
                <button onclick="pressKey('back')" class="key-btn text-orange-500">âŒ«</button>
            </div>

            <button id="login-btn" onclick="login()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl text-lg shadow-xl active:scale-95 transition-transform flex items-center justify-center space-x-2">
                <span id="login-btn-text">é–‹å§‹æŒ‘æˆ°</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </button>
            
            <div class="mt-4 flex justify-center space-x-4">
                <button onclick="toggleFullScreen()" class="text-slate-400 text-[10px] font-bold uppercase underline tracking-tighter">å…¨è¢å¹•æ¨¡å¼</button>
                <button onclick="showLeaderboardFromLogin()" class="text-indigo-400 text-[10px] font-bold uppercase underline tracking-tighter">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
            </div>
        </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ä»‹é¢ -->
    <div id="main-app" class="max-w-md mx-auto px-4 py-6 hidden">
        <header class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-sm font-black text-slate-400 uppercase tracking-widest">Speaking Challenge</h1>
                <div class="text-2xl font-extrabold text-indigo-600 leading-tight">
                    <span id="display-info">-- ç­ -- è™Ÿ</span>
                </div>
                <p class="text-slate-500 text-sm font-bold mt-1">ç´¯ç©ç¸½ç©åˆ†: <span id="display-score" class="text-amber-500">0</span></p>
            </div>
            <div class="flex space-x-2">
                <button onclick="toggleLeaderboard(true)" class="bg-white p-3 rounded-2xl shadow-sm text-xl active:scale-90 transition-transform">ğŸ†</button>
                <button onclick="logout()" class="bg-white px-3 py-1.5 rounded-2xl border border-slate-100 text-slate-400 flex flex-col items-center active:scale-90 transition-transform">
                    <span class="text-[9px] font-bold uppercase">Logout</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </button>
            </div>
        </header>
        <div class="flex p-1.5 bg-slate-200/50 backdrop-blur rounded-2xl mb-6" id="unit-tabs"></div>
        <div id="content-area" class="space-y-4 pb-24"></div>
        <div id="feedback-toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-sm p-6 rounded-[32px] hidden shadow-2xl text-center z-[100] transform transition-all animate-fade-in">
            <p id="feedback-text" class="text-xl font-black"></p>
            <div id="word-comparison" class="text-sm mt-3 flex flex-wrap justify-center gap-1.5 font-bold tracking-tight"></div>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œ Modal -->
    <div id="leaderboard-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white w-full max-w-md rounded-[40px] p-8 shadow-2xl max-h-[85vh] flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-extrabold text-slate-800 tracking-tighter italic">ğŸ† å‹‡è€…ç©åˆ†æ¦œ</h2>
                <button onclick="toggleLeaderboard(false)" class="text-slate-300 text-4xl hover:text-slate-500 transition-colors">&times;</button>
            </div>
            <div id="leaderboard-list" class="overflow-y-auto no-scrollbar flex-1 space-y-3">
                <div class="text-center py-10 text-slate-400 font-bold">è³‡æ–™è®€å–ä¸­...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // é‡è¦ï¼šè«‹å°‡ä¸‹æ–¹çš„è¨­å®šæ›¿æ›æˆä½ è‡ªå·±çš„ Firebase Config
        // ä½ å¯ä»¥åœ¨ Firebase Console > å°ˆæ¡ˆè¨­å®š > æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ ä¸­æ‰¾åˆ°
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAnth5dJL4asIgON8d1oYbyO713zek9S8U",
            authDomain: "AIzaSyAnth5dJL4asIgON8d1oYbyO713zek9S8U",
            projectId: "vocab-challenge-d9d85",
            storageBucket: "vocab-challenge-d9d85.firebasestorage.app",
            messagingSenderId: "345399946704",
            appId: "1:345399946704:web:d09cc15ef235e3676f1dd5"
        };
        
        const appId = "vocab-speaking-gh-pages"; // GitHub ä¸Šçš„å°ˆæ¡ˆæ¨™è­˜

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const VOCAB_DATA = {
            "L5 æ™‚é–“æ˜ŸæœŸ": [
                { id: "l5-1", en: "Monday", zh: "æ˜ŸæœŸä¸€" },
                { id: "l5-2", en: "Wednesday", zh: "æ˜ŸæœŸä¸‰" },
                { id: "l5-3", en: "Friday", zh: "æ˜ŸæœŸäº”" },
                { id: "l5-4", en: "weekend", zh: "é€±æœ«" },
                { id: "l5-5", en: "noon", zh: "ä¸­åˆ" },
                { id: "l5-6", en: "tonight", zh: "ä»Šæ™š" },
                { id: "l5-7", en: "o'clock", zh: "â€¦â€¦é»é˜" }
            ],
            "L6 æ ¡åœ’å ´æ‰€": [
                { id: "l6-1", en: "library", zh: "åœ–æ›¸é¤¨" },
                { id: "l6-2", en: "gym", zh: "é«”è‚²é¤¨" },
                { id: "l6-3", en: "playground", zh: "éŠæ¨‚å ´" },
                { id: "l6-4", en: "restroom", zh: "å»æ‰€" },
                { id: "l6-5", en: "gate", zh: "å¤§é–€" },
                { id: "l6-6", en: "sports field", zh: "é‹å‹•å ´" },
                { id: "l6-7", en: "building", zh: "å»ºç¯‰ç‰©" },
                { id: "l6-8", en: "classmate", zh: "åŒç­åŒå­¸" }
            ],
            "å‹•ä½œèˆ‡é—œéµè©": [
                { id: "m-1", en: "prepare", zh: "æº–å‚™" },
                { id: "m-2", en: "chat", zh: "è«‡è©±" },
                { id: "m-3", en: "join", zh: "åƒåŠ " },
                { id: "m-4", en: "look for", zh: "å°‹æ‰¾" },
                { id: "m-5", en: "find", zh: "æ‰¾åˆ°" },
                { id: "m-6", en: "work out", zh: "é›éŠèº«é«”" },
                { id: "m-7", en: "wear", zh: "ç©¿" },
                { id: "m-8", en: "meeting", zh: "æœƒè­°" },
                { id: "m-9", en: "hungry", zh: "é£¢é¤“çš„" },
                { id: "m-10", en: "however", zh: "ç„¶è€Œ" }
            ]
        };

        let currentClass = "", studentId = "", currentScore = 0;
        let masteredMap = {}; 
        let currentUnit = Object.keys(VOCAB_DATA)[0];
        let isRecording = false;
        let activeInput = 'class';
        let classInputStr = "";
        let seatInputStr = "";
        let isLeaderboardActive = false;

        const initAuth = async () => {
            if (auth.currentUser) return auth.currentUser;
            return await signInAnonymously(auth);
        };

        window.setActiveInput = (type) => { activeInput = type; updateInputDisplay(); };
        window.pressKey = (key) => {
            if (activeInput === 'class') {
                if (key === 'back') classInputStr = classInputStr.slice(0, -1);
                else if (key === 'clear') classInputStr = "";
                else if (classInputStr.length < 3) classInputStr += key;
            } else {
                if (key === 'back') seatInputStr = seatInputStr.slice(0, -1);
                else if (key === 'clear') seatInputStr = "";
                else if (seatInputStr.length < 2) seatInputStr += key;
            }
            updateInputDisplay();
        };

        function updateInputDisplay() {
            const classDisplay = document.getElementById('class-display');
            const seatDisplay = document.getElementById('seat-display');
            classDisplay.innerText = classInputStr || "--";
            seatDisplay.innerText = seatInputStr || "--";
            if (classInputStr) classDisplay.classList.replace('text-slate-300', 'text-indigo-600');
            else classDisplay.classList.replace('text-indigo-600', 'text-slate-300');
            if (seatInputStr) seatDisplay.classList.replace('text-slate-300', 'text-indigo-600');
            else seatDisplay.classList.replace('text-indigo-600', 'text-slate-300');
            classDisplay.classList.toggle('input-active', activeInput === 'class');
            seatDisplay.classList.toggle('input-active', activeInput === 'seat');
        }

        window.login = async () => {
            if (!classInputStr || !seatInputStr || parseInt(seatInputStr) === 0) {
                document.getElementById('login-status').innerText = "âŒ è«‹è¼¸å…¥å®Œæ•´çš„ç­ç´šèˆ‡åº§è™Ÿï¼";
                return;
            }
            const btn = document.getElementById('login-btn');
            btn.disabled = true;
            try {
                await initAuth();
                currentClass = classInputStr;
                studentId = seatInputStr;
                const userRef = doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'progress', 'status');
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    masteredMap = userSnap.data().masteredMap || {};
                    currentScore = userSnap.data().score || 0;
                }
                const loginData = { class: currentClass, seat: studentId, score: currentScore, masteredMap: masteredMap, updatedAt: serverTimestamp(), uid: auth.currentUser.uid };
                await setDoc(userRef, loginData, { merge: true });
                await syncToPublicLeaderboard(loginData);
                document.getElementById('display-info').innerText = `${currentClass} ç­ ${studentId} è™Ÿ`;
                updateTotalScoreUI();
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                renderUnitTabs();
                renderVocab();
                setupLeaderboardListener();
            } catch (error) {
                alert("ç™»å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª Firebase è¨­å®šæ˜¯å¦æ­£ç¢ºã€‚");
                btn.disabled = false;
            }
        };

        function updateTotalScoreUI() { currentScore = Object.keys(masteredMap).length * 4; document.getElementById('display-score').innerText = currentScore; }
        window.logout = () => { if(confirm("ç¢ºå®šè¦æ›´æ›æŒ‘æˆ°è€…å—ï¼Ÿ")) location.reload(); };
        window.playPronunciation = (text, speed) => { window.speechSynthesis.cancel(); const utterance = new SpeechSynthesisUtterance(text); utterance.lang = 'en-US'; utterance.rate = speed; window.speechSynthesis.speak(utterance); };
        function clean(s) { return s.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()?]/g,"").split(/\s+/).filter(x => x.length > 0); }

        window.handleStartSpeaking = (id, targetText, btn) => {
            if (isRecording) return;
            const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRec) { showFeedback("æ­¤è£ç½®ä¸æ”¯æ´èªéŸ³è¾¨è­˜", "fail"); return; }
            const recognition = new SpeechRec();
            recognition.lang = 'en-US';
            isRecording = true;
            btn.innerHTML = `<span class="recording-pulse">ğŸ”´ è†è½ä¸­...</span>`;
            recognition.start();
            recognition.onresult = async (e) => {
                const saidText = e.results[0][0].transcript;
                const targetWords = clean(targetText);
                const saidWords = clean(saidText);
                let correctCount = 0;
                const comparisonDiv = document.getElementById('word-comparison');
                comparisonDiv.innerHTML = "";
                targetWords.forEach(tw => {
                    const span = document.createElement('span');
                    span.innerText = tw;
                    if (saidWords.includes(tw)) { correctCount++; span.className = "text-green-300"; }
                    else { span.className = "text-red-200 line-through opacity-70"; }
                    comparisonDiv.appendChild(span);
                });
                if (correctCount === targetWords.length) {
                    if (!masteredMap[id]) {
                        masteredMap[id] = true;
                        updateTotalScoreUI();
                        const updateData = { score: currentScore, masteredMap: masteredMap, updatedAt: serverTimestamp(), class: currentClass, seat: studentId, uid: auth.currentUser.uid };
                        await updateDoc(doc(db, 'artifacts', appId, 'users', auth.currentUser.uid, 'progress', 'status'), updateData);
                        await syncToPublicLeaderboard(updateData);
                    }
                    showFeedback("Excellent! ğŸŒŸ", "success");
                    playSuccessSound();
                } else { showFeedback("Try again!", "fail"); }
            };
            recognition.onerror = () => { isRecording = false; showFeedback("æœªåµæ¸¬åˆ°è²éŸ³", "fail"); renderVocab(); };
            recognition.onend = () => { isRecording = false; renderVocab(); };
        };

        async function syncToPublicLeaderboard(scoreData) {
            if (!auth.currentUser) return;
            try {
                const pubRef = doc(db, 'artifacts', appId, 'public', 'data', 'leaderboard', auth.currentUser.uid);
                await setDoc(pubRef, { ...scoreData, uid: auth.currentUser.uid, updatedAt: serverTimestamp() }, { merge: true });
            } catch (e) { console.error(e); }
        }

        function renderUnitTabs() {
            const tabs = document.getElementById('unit-tabs');
            tabs.innerHTML = '';
            Object.keys(VOCAB_DATA).forEach(unit => {
                const btn = document.createElement('button');
                btn.className = `flex-1 py-2.5 rounded-xl font-extrabold text-xs transition-all ${currentUnit === unit ? 'unit-tab-active' : 'text-slate-500'}`;
                btn.innerText = unit;
                btn.onclick = () => { currentUnit = unit; renderUnitTabs(); renderVocab(); };
                tabs.appendChild(btn);
            });
        }

        function renderVocab() {
            const container = document.getElementById('content-area');
            container.innerHTML = '';
            VOCAB_DATA[currentUnit].forEach(item => {
                const isMastered = masteredMap[item.id];
                const card = document.createElement('div');
                card.className = `glass-card p-6 border-2 transition-all duration-300 ${isMastered ? 'border-green-300 bg-green-50/50' : 'border-transparent'}`;
                const safeEn = item.en.replace(/'/g, "\\'");
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <p class="text-3xl font-black ${isMastered ? 'text-green-600' : 'text-slate-800'} tracking-tight">${item.en}</p>
                            <p class="text-sm text-slate-400 font-bold mt-1 tracking-wide">${item.zh}</p>
                        </div>
                        <div class="flex flex-col items-end space-y-2">
                            ${isMastered ? '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-[10px] font-black uppercase">Mastered</span>' : '<span class="bg-slate-100 text-slate-400 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter">Unfinished</span>'}
                            <div class="flex space-x-1.5">
                                <button onclick="playPronunciation('${safeEn}', 1.0)" class="speed-btn">ğŸ“¢ æ­£å¸¸</button>
                                <button onclick="playPronunciation('${safeEn}', 0.6)" class="speed-btn">ğŸ¢ æ…¢é€Ÿ</button>
                            </div>
                        </div>
                    </div>
                    <button onclick="handleStartSpeaking('${item.id}', '${safeEn}', this)" class="w-full ${isMastered ? 'bg-green-500' : 'bg-indigo-600'} text-white py-4 rounded-2xl font-black text-lg shadow-lg active:scale-95 transition-all flex items-center justify-center space-x-2"><span>${isMastered ? 'å†æ¬¡æŒ‘æˆ°' : 'é–‹å§‹å£èªª'}</span></button>`;
                container.appendChild(card);
            });
        }

        window.setupLeaderboardListener = async () => {
            if (isLeaderboardActive) return;
            try {
                await initAuth();
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard'), (snap) => {
                    isLeaderboardActive = true;
                    const players = []; snap.forEach(d => players.push(d.data()));
                    if (players.length === 0) { document.getElementById('leaderboard-list').innerHTML = `<div class="text-center py-10 text-slate-400 font-bold">ç›®å‰å°šç„¡æŒ‘æˆ°æ•¸æ“š</div>`; return; }
                    players.sort((a,b) => (b.score || 0) - (a.score || 0) || String(a.class).localeCompare(String(b.class)) || parseInt(a.seat) - parseInt(b.seat));
                    document.getElementById('leaderboard-list').innerHTML = players.map((p,i) => `
                        <div class="flex items-center justify-between p-4 rounded-[24px] ${p.uid === auth.currentUser?.uid ? 'bg-indigo-600 text-white shadow-xl scale-[1.02]' : 'bg-slate-50'} transition-all">
                            <span class="font-black w-8 text-center text-sm ${p.uid === auth.currentUser?.uid ? 'text-white/50' : 'text-slate-300'}">${i+1}</span>
                            <div class="flex-1 flex flex-col ml-3"><span class="text-[10px] font-bold uppercase ${p.uid === auth.currentUser?.uid ? 'text-white/70' : 'text-slate-400'}">${p.class || '--'} ç­ - ${p.seat || '--'} è™Ÿ</span><span class="font-extrabold text-lg tracking-tight">å°å‹‡è€…</span></div>
                            <div class="text-right"><span class="block font-black text-2xl">${p.score || 0}</span></div>
                        </div>`).join('');
                });
            } catch (e) { console.error(e); }
        };

        function showFeedback(msg, type) { const toast = document.getElementById('feedback-toast'); toast.className = `fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-sm p-6 rounded-[32px] shadow-2xl text-center z-[100] ${type === 'success' ? 'bg-green-600 text-white' : 'bg-red-500 text-white'}`; document.getElementById('feedback-text').innerText = msg; toast.classList.remove('hidden'); setTimeout(() => toast.classList.add('hidden'), 3500); }
        function playSuccessSound() { const ctx = new (window.AudioContext || window.webkitAudioContext)(); const osc = ctx.createOscillator(); const gain = ctx.createGain(); osc.connect(gain); gain.connect(ctx.destination); osc.frequency.setValueAtTime(523, ctx.currentTime); osc.frequency.exponentialRampToValueAtTime(1046, ctx.currentTime + 0.1); gain.gain.setValueAtTime(0, ctx.currentTime); gain.gain.linearRampToValueAtTime(0.2, ctx.currentTime + 0.05); gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3); osc.start(); osc.stop(ctx.currentTime + 0.3); }
        window.toggleLeaderboard = (show) => document.getElementById('leaderboard-modal').classList.toggle('hidden', !show);
        window.showLeaderboardFromLogin = () => { window.setupLeaderboardListener(); toggleLeaderboard(true); };
        window.toggleFullScreen = () => { const de = document.documentElement; if (!document.fullscreenElement) { if (de.requestFullscreen) de.requestFullscreen(); else if (de.webkitRequestFullscreen) de.webkitRequestFullscreen(); } else { if (document.exitFullscreen) document.exitFullscreen(); else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); } };
        updateInputDisplay();
    </script>
</body>
</html>